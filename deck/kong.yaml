_format_version: "3.0"
_konnect:
  control_plane_name: mcp-control-plane
_info:
  select_tags:
    - mcp:example
services:
- connect_timeout: 60000
  enabled: true
  host: agent-test.agent-test.svc.cluster.local
  name: agent-service
  port: 3443
  protocol: http
  read_timeout: 60000
  retries: 5
  routes:
  - https_redirect_status_code: 426
    name: agent-prompt-route
    path_handling: v0
    paths:
    - /ask
    preserve_host: false
    protocols:
    - http
    - https
    regex_priority: 0
    request_buffering: true
    response_buffering: false
    strip_path: false
  - https_redirect_status_code: 426
    methods:
    - GET
    name: agent-route
    path_handling: v0
    preserve_host: false
    protocols:
    - http
    - https
    regex_priority: 0
    request_buffering: true
    response_buffering: true
    strip_path: true
  write_timeout: 60000
- connect_timeout: 60000
  enabled: true
  host: localhost
  name: llm-target-service
  plugins:
  - config:
      balancer:
        algorithm: round-robin
        connect_timeout: 60000
        failover_criteria:
        - error
        - timeout
        hash_on_header: X-Kong-LLM-Request-ID
        latency_strategy: tpot
        read_timeout: 60000
        retries: 5
        slots: 10000
        tokens_count_strategy: total-tokens
        write_timeout: 60000
      embeddings: null
      genai_category: text/generation
      llm_format: openai
      max_request_body_size: 8192
      model_name_header: true
      response_streaming: allow
      targets:
      - auth:
          allow_override: false
          aws_access_key_id: null
          aws_secret_access_key: null
          azure_client_id: null
          azure_client_secret: null
          azure_tenant_id: null
          azure_use_managed_identity: false
          gcp_service_account_json: null
          gcp_use_service_account: false
          header_name: Authorization
          header_value: '{vault://mcpvault/openai-key}'
          param_location: null
          param_name: null
          param_value: null
        description: null
        logging:
          log_payloads: true
          log_statistics: true
        model:
          name: gpt-4.1-2025-04-14
          options:
            anthropic_version: null
            azure_api_version: "2023-05-15"
            azure_deployment_id: null
            azure_instance: null
            bedrock:
              aws_assume_role_arn: null
              aws_region: null
              aws_role_session_name: null
              aws_sts_endpoint_url: null
              embeddings_normalize: false
              performance_config_latency: null
            cohere:
              embedding_input_type: classification
              wait_for_model: null
            embeddings_dimensions: null
            gemini:
              api_endpoint: null
              endpoint_id: null
              location_id: null
              project_id: null
            huggingface:
              use_cache: null
              wait_for_model: null
            input_cost: null
            llama2_format: null
            max_tokens: null
            mistral_format: null
            output_cost: null
            temperature: null
            top_k: null
            top_p: null
            upstream_path: null
            upstream_url: null
          provider: openai
        route_type: llm/v1/chat
        weight: 100
      vectordb: null
    enabled: true
    name: ai-proxy-advanced
    protocols:
    - grpc
    - grpcs
    - http
    - https
  port: 80
  protocol: http
  read_timeout: 60000
  retries: 5
  routes:
  - https_redirect_status_code: 426
    name: llm-chat-route
    path_handling: v0
    paths:
    - /chat
    preserve_host: false
    protocols:
    - http
    - https
    regex_priority: 0
    request_buffering: true
    response_buffering: true
    strip_path: true
  write_timeout: 60000
- connect_timeout: 60000
  enabled: true
  host: api-service.default.svc.cluster.local
  name: mcp-service
  port: 9080
  protocol: http
  read_timeout: 60000
  retries: 5
  routes:
  - https_redirect_status_code: 426
    name: mcp-route
    path_handling: v0
    paths:
    - /marketplace
    plugins:
    - config:
        logging:
          log_payloads: false
          log_statistics: false
        max_request_body_size: 8192
        mode: conversion-listener
        server:
          forward_client_headers: true
          tag: null
          timeout: 60000
        tools:
        - annotations: null
          description: Get users
          headers: null
          host: null
          method: GET
          parameters:
          - description: Optional user ID
            in: query
            name: id
            required: false
            schema:
              type: string
          path: /marketplace/users
          query: null
          request_body: null
          scheme: null
        - annotations: null
          description: Get orders for a user
          headers: null
          host: null
          method: GET
          parameters:
          - description: User ID to filter orders
            in: query
            name: userid
            required: true
            schema:
              type: string
          path: /marketplace/orders
          query: null
          request_body: null
          scheme: null
      enabled: true
      name: ai-mcp-proxy
      protocols:
      - grpc
      - grpcs
      - http
      - https
    preserve_host: false
    protocols:
    - http
    - https
    regex_priority: 0
    request_buffering: true
    response_buffering: true
    strip_path: true
  write_timeout: 60000
